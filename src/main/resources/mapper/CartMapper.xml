<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.weavus.weavusshoppingmall.repository.CartMapper">
    <insert id="addItemToCart" parameterType="com.weavus.weavusshoppingmall.entity.Cart">
        insert into cart (item_id, id)
        values (
                #{item_id},
                #{id}
               )
    </insert>

    <resultMap id="CartResultMap" type="com.weavus.weavusshoppingmall.entity.Cart">
        <id column="cart_id" property="cartId"/>
        <result column="id" property="id"/>
        <result column="item_id" property="itemId"/>
        <result column="cart_stock" property="cartStock"/>
        <result column="created_at" property="createdAt"/>

        <collection property="itemList" ofType="com.weavus.weavusshoppingmall.entity.Item">
            <id column="item_id" property="itemId"/>
            <result column="item_name" property="itemName"/>
            <result property="itemCategory" column="item_category" />
            <result column="item_price" property="itemPrice" />
            <result column="item_info" property="itemInfo" />
            <result property="filepath" column="filepath" />
            <result property="filename" column="filename" />
            <!-- 추가적인 Item 필드 매핑 -->
        </collection>
    </resultMap>
    
    <select id="findCartInfoByUserId" resultType="com.weavus.weavusshoppingmall.entity.Cart" resultMap="CartResultMap">
        SELECT c.*, i.*
        FROM cart c
        LEFT JOIN item i ON c.item_id = i.item_id
        WHERE c.id = #{id}
    </select>

    <delete id="clearCartByUserId">
        DELETE from cart WHERE id = #{id}
    </delete>

</mapper>